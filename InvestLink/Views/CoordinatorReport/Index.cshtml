
@{
    ViewBag.Title = "Index ";
}

﻿@using InvestLink_BLL.Interfaces
@using InvestLink_DAL.Entities
@using Microsoft.AspNetCore.Identity

@inject SignInManager<IdentityUser> signInManager
@inject ICoordinatorReport icoordinatorReport;
@inject IEmployee iEmployee;



@{
    var user = await signInManager.UserManager.GetUserAsync(signInManager.Context.User);
    var email = await signInManager.UserManager.GetEmailAsync(user);

    // متغير
    IEnumerable<CoordinatorReport> coordinatorReports;
  

    if (User.IsInRole("FollowUpEmployee"))
    {
        var iEmp = await iEmployee.GetByEmailAsync(email);
        var iEmptId = iEmp.Id;


        coordinatorReports = await icoordinatorReport.GetAllAsync(iEmptId);
    }
    else
    {
    coordinatorReports = await icoordinatorReport.GetAllAsync();
    }

}


@*  لموظف المتابعة و رئيس خدمات المستثمرين*@


<hr>
<div class="card">
    <div class="card-body">
        <table class="table mb-0 table-hover">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">اسم</th>
                    <th scope="col"> حالة تقرير</th>
    
                    <th scope="col"> الاجراءات</th>
    
                </tr>
            </thead>
            <tbody>
                @{
                    int Count = 0;
                }
                @foreach (var Item in coordinatorReports)
                {
                    if(Item.ProjectCoordinator.Project.State != "سحب الترخيص" && Item.ProjectCoordinator.Project.State != "مرفوض")
                    {
                                Count++;
         <tr>
             <th scope="row"> <div style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700; color: #4facfe;">
                             @Count
                         </div></th>

             <td>@Item.ProjectCoordinator.Project.Name</td>
             <td>@Item.Status</td>

             <td>
                 <a asp-controller="CoordinatorReport"
                    asp-action="Details"
                    asp-route-id="@Item.Id"
                       class="btn btn-sm" 
                            style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: none; border-radius: 10px; padding: 0.5rem 1rem; color: #667eea; font-weight: 600; transition: all 0.3s ease;"
                            onmouseover="this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.color='white';"
                            onmouseout="this.style.background='linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)'; this.style.color='#667eea';">
                             <ion-icon name="eye-outline" style="vertical-align: middle; margin-left: 0.25rem;"></ion-icon>
                             عرض التفاصيل
                 </a>
                 

             </td>

          @if (User.IsInRole("HeadOfServices") || User.IsInRole("Admin"))
 {
                 

                     @if(Item.ProjectCoordinator != null)
                     {
                         var projectId = Item.ProjectCoordinator.ProjectId;
                 
                         <td>
                         
                              <a asp-controller="CoordinatorReport"
        asp-action="ReCreateLicense"
        asp-route-projectId="@projectId"
        class="btn btn-info waves-effect">
         <i class="fadeIn animated bx bx-pencil"></i>
     </a>
</td>
    <td>

         <a asp-controller="CoordinatorReport"
            asp-action="RejectLicenses"
            asp-route-projectId="@projectId"
            
            class="btn btn-danger px-4">
             <ion-icon name="lock-closed-outline"></ion-icon>
         </a>
            </td> 
                    }
                    }

           

           
        </tr>
    }

                }
                               
              
           
           
               
            
            </tbody>
        </table>
    </div>
</div>